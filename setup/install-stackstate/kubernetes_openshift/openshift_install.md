---
description: SUSE Observability Self-hosted
---

# OpenShift install

## Before you start

{% hint style="info" %}
Extra notes for installing on:

* **OpenShift clusters with limited permissions**: Read the [required permissions](required_permissions.md).
* **Kubernetes**: Refer to the [Kubernetes installation instructions](kubernetes_install.md).
{% endhint %}

Before you start the installation of SUSE Observability:

* Check that your OpenShift environment meets the [requirements](../requirements.md)
* Ensure you have the OpenShift command line tools installed \(`oc`\)
* Add the SUSE Observability helm repository to the local helm client:

```text
helm repo add suse-observability https://charts.rancher.com/server-charts/prime/suse-observability
helm repo update
```

## Install SUSE Observability

{% hint style="info" %}
For environments without internet access, also known as air-gapped environments, first follow [these extra instructions](/k8s-suse-rancher-prime-air-gapped.md).

Also make sure to follow the air-gapped instalaltion instructions whenever those are present for a step.
{% endhint %}

1. [Create the project where SUSE Observability will be installed](openshift_install.md#create-project)
1. [Generate the `values.yaml` file](openshift_install.md#generate-values.yaml)
1. [Create the `openshift-values.yaml` file](openshift_install.md#create-openshift-values.yaml)
1. [Deploy SUSE Observability with Helm](openshift_install.md#deploy-suse-observability-with-helm)
1. [Access the SUSE Observability UI](openshift_install.md#access-the-suse-observability-ui)
1. [Manually create `SecurityContextConfiguration` objects](openshift_install.md#manually-create-securitycontextconfiguration-objects)

### Create project

Start by creating the project where you want to install SUSE Observability. In our walkthrough we will use the namespace `suse-observability`:

```text
oc new-project suse-observability
```

{% hint style="info" %}
The project name is used in `helm` and `kubectl` commands as the namespace name in the `--namespace` flag
{% endhint %}

### Generate `values.yaml`

The `values.yaml` file is required to deploy SUSE Observability with Helm. It contains your SUSE Observability license key, SUSE Observability Receiver API key and other important information.

{% hint style="info" %}
**Before you continue:** Make sure you have the latest version of the Helm charts with `helm repo update`.
{% endhint %}

The SUSE Observability `values.yaml` file can be generated by running a separate Helm Chart, the `suse-observability/suse-observability-values` chart. A sample command line is:

```text
> helm template \
  --set license='<your license>' \
  --set baseUrl='<suse-observability-base-url>' \
  sts-values \
  suse-observability/suse-observability-values > values.yaml
```

This command will generate a values.yaml file which contains the necessary configuration for installing the SUSE Observability Helm Chart.

{% hint style="info" %}
The SUSE Observability administrator passwords will be autogenerated by the above command and are output as comments in the generated `values.yaml` file. The actual values contain the `bcrypt` hashes of those passwords so that they're securely stored in the Helm release in the cluster.
{% endhint %}

The values that can be passed to this chart are:

| Configuration | Value | Description                                                                                                                                                                                                                                                                                                                                                                                 |
| :--- | :--- |:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Receiver API Key | `receiverApiKey` | The API key used by SUSE Observability to receive data from agents. This is a secret key that should be kept private. If you omit this, a random key will be generated for you. |
| Base URL | `baseUrl` | The `<STACKSTATE_BASE_URL>`. The external URL for SUSE Observability that users and agents will use to connect. For example `https://suse-observability.internal`. If you haven't decided on an Ingress configuration yet, use `http://localhost:8080`. This can be updated later in the generated file.                                                                                                    |
| Username and password\*\* | `-u` `-p` | The username and password used by SUSE Observability to pull images. For air-gapped environments these need to be the username and password for the local docker registry. |
| License key | `license` | The SUSE Observability license key. |
| Admin API password | `adminApiPassword` | The password for the admin API. Note that this API contains system maintenance functionality and should only be accessible by the maintainers of the SUSE Observability installation. If you omit this, a random password will be generated for you. If you do pass this value and it's not bcrypt hashed, the chart will hash it for you. |
| Default password | `adminPassword` | The password for the default user \(`admin`\) to access SUSE Observability's UI. If you omit this, a random password will be generated for you. If you do pass this value and it's not bcrypt hashed, the chart will hash it for you.|
| Image Registry | `imageRegistry` | The registry where the SUSE Observability images are hosted. If not provided, the default value will be 'quay.io' |
| Pull Secret Username | `pullSecret.username` | The username used to pull images from the Docker registry where the SUSE Observability images are hosted. |
| Pull Secret Password | `pullSecret.password` | The password used to pull images from the Docker registry where the SUSE Observability images are hosted. |

{% hint style="info" %}
Store the generated `values.yaml` file somewhere safe. You can reuse this file for upgrades, which will save time and \(more importantly\) will ensure that SUSE Observability continues to use the same API key. This is desirable as it means Agents and other data providers for SUSE Observability won't need to be updated.
{% endhint %}

### Create `openshift-values.yaml`

Because OpenShift has stricter security model than plain Kubernetes, all of the standard security contexts in the deployment need to be disabled.

Create a Helm values file `openshift-values.yaml` with the following content and store it next to the generated `values.yaml` file. This contains the values that are needed for an OpenShift deployment.
```yaml
elasticsearch:
  prometheus-elasticsearch-exporter:
    podSecurityContext: ""
  sysctlInitContainer:
    enabled: false
scc:
  enabled: true
```

### Deploy SUSE Observability with Helm

The recommended deployment of SUSE Observability is a production ready, high availability setup with many services running redundantly. If required, it's also possible to run SUSE Observability in a non-redundant setup, where each service has only a single replica. This setup is only recommended for a test environment.

For air-gapped environments follow the instructions for the air-gapped installations.

{% tabs %}
{% tab title="High availability setup" %}

To deploy SUSE Observability in a high availability setup on OpenShift:

1. Before you deploy:
   * [Create the project where SUSE Observability will be installed](openshift_install.md#create-project)
   * [Generate `values.yaml`](#generate-values.yaml)
   * [Create `openshift-values.yaml`](#create-openshift-values.yaml)
2. **(Optionally)** [Create a `small_values.yaml`](small_profile_setup.md) if you want to deploy a small profile setup. Add the `--values small_values.yaml` flag to the command below.
3. Deploy the latest SUSE Observability version to the `suse-observability` namespace with the following command:

```text
helm upgrade \
  --install \
  --namespace suse-observability \
  --values values.yaml \
  --values openshift-values.yaml \
suse-observability \
suse-observability/suse-observability
```
{% endtab %}
{% tab title="Non-high availability setup" %}

To deploy SUSE Observability in a non-high availability setup on OpenShift:

1. Before you deploy:
   * [Create the project where SUSE Observability will be installed](openshift_install.md#create-project)
   * [Generate `values.yaml`](#generate-values.yaml)
   * [Create `openshift-values.yaml`](#create-openshift-values.yaml)
   * [Create `nonha_values.yaml`](/setup/install-stackstate/kubernetes_openshift/non_high_availability_setup.md)
2. Deploy the latest SUSE Observability version to the `suse-observability` namespace with the following command:

```bash
helm upgrade \
  --install \
  --namespace suse-observability \
  --values local-docker-registry.yaml \
  --values values.yaml \
  --values nonha_values.yaml \
  --values openshift-values.yaml \
suse-observability \
suse-observability/suse-observability
```
{% endtab %}
{% tab title="Air-gapped, high availability setup" %}

To deploy SUSE Observability in a high availability setup on OpenShift:

1. Before you deploy:
   * [Create the project where SUSE Observability will be installed](openshift_install.md#create-project)
   * [Generate `values.yaml`](#generate-values.yaml)
   * [Create `openshift-values.yaml`](#create-openshift-values.yaml)
2. **(Optionally)** [Create a `small_values.yaml`](small_profile_setup.md) if you want to deploy a small profile setup. Add the `--values small_values.yaml` flag to the command below.
3. Deploy the latest SUSE Observability version to the `suse-observability` namespace with the following command:

```text
helm upgrade \
  --install \
  --namespace suse-observability \
  --values local-docker-registry.yaml \
  --values values.yaml \
  --values openshift-values.yaml \
suse-observability \
suse-observability/suse-observability
```
{% endtab %}
{% tab title="Air-gapped, non-high availability setup" %}

To deploy SUSE Observability in a non-high availability setup on OpenShift:

1. Before you deploy:
   * [Create the project where SUSE Observability will be installed](openshift_install.md#create-project)
   * [Generate `values.yaml`](#generate-values.yaml)
   * [Create `openshift-values.yaml`](#create-openshift-values.yaml)
   * [Create `nonha_values.yaml`](/setup/install-stackstate/kubernetes_openshift/non_high_availability_setup.md)
2. Deploy the latest SUSE Observability version to the `suse-observability` namespace with the following command:

```bash
helm upgrade \
  --install \
  --namespace suse-observability \
  --values values.yaml \
  --values nonha_values.yaml \
  --values openshift-values.yaml \
suse-observability \
suse-observability/suse-observability
```
{% endtab %}
{% endtabs %}

After the install, the SUSE Observability release should be listed in the SUSE Observability namespace and all pods should be running:

```text
# Check the release is listed
helm list --namespace suse-observability

# Check pods are running
# It may take some time for all pods to be installed or available
kubectl get pods --namespace suse-observability
```

### Access the SUSE Observability UI

After SUSE Observability has been deployed, you can check if all pods are up and running:

```text
kubectl get pods --namespace suse-observability
```

When all pods are up, you can enable a port-forward:

```text
kubectl port-forward service/suse-observability-router 8080:8080 --namespace suse-observability
```

SUSE Observability will now be available in your browser at `https://localhost:8080`. Log in with the username `admin` and the default password provided in the `values.yaml` file.

Next steps are

* [Expose SUSE Observability outside of the cluster](ingress.md)
* [Start monitoring your Kubernetes clusters](../../../k8s-quick-start-guide.md)
* Give your [co-workers access](/setup/security/authentication/README.md).

## Manually create `SecurityContextConfiguration` objects

If you can't use an administrator account to install SUSE Observability on OpenShift, ask your administrator to apply the below `SecurityContextConfiguration` objects.

```yaml
apiVersion: security.openshift.io/v1
kind: SecurityContextConstraints
metadata:
  name: {{ template "common.fullname.short" . }}-{{ .Release.Namespace }}
  labels:
    {{- include "common.labels.standard" . | nindent 4 }}
  annotations:
    helm.sh/hook: pre-install
    suse-observability.io/note: "Ignored by helm uninstall, has to be deleted manually"
fsGroup:
  type: RunAsAny
groups:
- system:serviceaccounts:{{ .Release.Namespace }}
runAsUser:
  type: RunAsAny
seLinuxContext:
  type: MustRunAs
supplementalGroups:
  type: RunAsAny
volumes:
- configMap
- downwardAPI
- emptyDir
- ephemeral
- persistentVolumeClaim
- projected
- secret
allowHostDirVolumePlugin: false
allowHostIPC: false
allowHostNetwork: false
allowHostPID: false
allowHostPorts: false
allowPrivilegeEscalation: true
allowPrivilegedContainer: false
readOnlyRootFilesystem: false
```

## See also

* [Create a `nonha_values.yaml` file](/setup/install-stackstate/kubernetes_openshift/non_high_availability_setup.md)
* [Create a `small_values.yaml` file](/setup/install-stackstate/kubernetes_openshift/small_profile_setup.md)
* For other configuration and management options, refer to the Kubernetes documentation - [manage a SUSE Observability Kubernetes installation](kubernetes_install.md)
